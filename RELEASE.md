# リリース手順

このプロジェクトでは、GitHub Actionsを使用してリリース時にバイナリを自動生成・アップロードします。

## リリースの作成方法

### 方法1: GitHub Release作成時に自動アップロード

1. **GitHubでリリースを作成**:
   - GitHubの「Releases」ページに移動
   - 「Create a new release」をクリック
   - タグ名（例: `v1.0.0`）を入力
   - リリースタイトルと説明を入力
   - 「Publish release」をクリック

2. **自動ビルドとアップロード**:
   - GitHub Actionsが自動的に実行される
   - 全プラットフォーム用バイナリがビルドされる
   - バイナリがリリースに自動アップロードされる

### 方法2: 手動ワークフロー実行

1. **GitHub Actionsで手動実行**:
   - 「Actions」タブに移動
   - 「Manual Release」ワークフローを選択
   - 「Run workflow」をクリック
   - バージョン名（例: `v1.0.0`）を入力
   - プレリリースかどうかを選択
   - 「Run workflow」をクリック

2. **自動ビルドとリリース作成**:
   - 指定したバージョンでリリースが作成される
   - 全プラットフォーム用バイナリがビルドされる
   - バイナリがリリースに自動アップロードされる

## 自動実行される処理

リリース作成時に、GitHub Actionsが自動的に以下を実行します：

1. **フロントエンドのビルド** - Reactアプリケーションをビルド
2. **マルチプラットフォームバイナリの作成**:
   - Linux AMD64 (`server-linux`)
   - Linux ARM64 (`server-linux-arm64`)
   - Windows AMD64 (`server-windows.exe`)
   - macOS AMD64 (`server-macos-amd64`)
   - macOS ARM64 (`server-macos-arm64`)

3. **リリースアーカイブの作成**:
   - 各プラットフォーム用のtar.gz/zipファイル
   - フロントエンドファイル、README、LICENSE、設定ファイルを含む

4. **GitHub Releaseの作成**:
   - タグ名をバージョンとして使用
   - 全プラットフォーム用のバイナリを添付
   - リリースノートを自動生成

## ローカルでのビルド

### 全プラットフォーム用バイナリの作成

```bash
# フロントエンドをビルド
cd web && npm install && npm run build && cd ..

# 全プラットフォーム用バイナリを作成
make build-all
```

### リリースアーカイブの作成

```bash
# リリース用アーカイブを作成
make create-release-archives
```

## バージョン情報

ビルドされたバイナリには以下の情報が含まれます：

- **Version**: タグ名（例: v1.0.0）
- **Build Time**: ビルド日時（UTC）
- **Git Commit**: コミットハッシュ
- **Go Version**: 使用したGoのバージョン

バージョン情報は `/api/version` エンドポイントで確認できます。

## バージョンの命名規則

- セマンティックバージョニングを使用: `v1.0.0`, `v1.2.3`, `v2.0.0-beta.1`
- `v` プレフィックスを付ける
- 例: `v1.0.0`, `v1.1.0`, `v2.0.0-rc.1`

## リリースの確認

1. GitHubの「Releases」ページでリリースを確認
2. 各プラットフォーム用のバイナリが正しく添付されているか確認
3. リリースノートが適切に生成されているか確認

## ワークフローの種類

### 1. Release ワークフロー
- **トリガー**: GitHub Releaseが公開された時
- **用途**: 既存のリリースにバイナリをアップロード
- **ファイル**: `.github/workflows/release.yml`

### 2. Manual Release ワークフロー
- **トリガー**: 手動実行
- **用途**: 新しいリリースを作成してバイナリをアップロード
- **ファイル**: `.github/workflows/manual-release.yml`

## トラブルシューティング

### ビルドが失敗する場合

1. フロントエンドのビルドエラーを確認
2. Goの依存関係を確認: `go mod tidy`
3. GitHub Actionsのログを確認

### リリースが作成されない場合

1. GitHub Actionsの権限設定を確認
2. ワークフローファイルの構文を確認
3. 手動ワークフローを使用してリリースを作成

### バイナリがアップロードされない場合

1. リリースが正しく作成されているか確認
2. GitHub Actionsのログでアップロードエラーを確認
3. ファイルサイズが制限内か確認（GitHubの制限: 2GB）
